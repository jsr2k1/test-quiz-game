using UnityEngine;
using UnityEngine.UI;
using System.Collections;

//Controlador para las letras de la respuesta
public class ButtonLetterCtrl : MonoBehaviour
{
	public int index;

	public Text text;
	public ButtonPanelCtrl buttonPanelCtrl;		//Letra del panel que se ha pulsado (linkamos para poder colocarla si el usuario la borra)
	public string answer;						//Letra que corresponde a la respuesta correcta
	public bool bCorrect;						//true si se ha forzado la respuesta pulsando el boton
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	void Awake()
	{
		text = transform.GetChild(0).GetComponent<Text>();
	}
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public void SetAnswer(string s)
	{
		answer = s;
	}
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public void SetCorrectText()
	{
		text.text = answer;
		bCorrect = true;
		text.color = Color.green;
	}
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public bool isCorrect()
	{
		return answer == text.text;
	}
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public bool CheckAnswer()
	{
		return (text.text == answer);
	}
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	void OnEnable()
	{
		AnswersManager.OnLetterButtonPressed += SetLetter;
	}
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	void OnDisable()
	{
		AnswersManager.OnLetterButtonPressed -= SetLetter;
	}

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//Si esta es la siguiente letra a rellenar -> la rellenamos
	void SetLetter()
	{
		if(index==AnswersManager.instance.currentIndex){
			text.text = AnswersManager.instance.currentLetter;
			buttonPanelCtrl = AnswersManager.instance.currentButtonPanelCtrl;
		}
	}
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//Si se pulsa una letra de la respuesta hay que quitar esa letra y volverla a poner en el panel
	public void OnButtonPressed()
	{
		if(!bCorrect && buttonPanelCtrl!=null){
			text.text = "";
			buttonPanelCtrl.SetLetterEnable();
			AnswersManager.instance.SetNextIndex();
			AudioManager.instance.PlayAudio(AudioManager.Audios.ButtonClickAlt);
		}
	}
}











